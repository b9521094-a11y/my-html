<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ç¨‹ç…§ç‰‡æµ®æ°´å°ç”¢ç”Ÿå™¨ (ä¿®æ”¹ç‰ˆ)</title>
    <style>
        /* ä¿æŒæ¨£å¼ä¸€è‡´æ€§ */
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h2 { color: #007bff; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #333; }
        input[type="text"], input[type="date"], input[type="file"], select { 
            width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; 
        }
        select { height: 40px; } /* ç¢ºä¿å–®é¸ä¸‹æ‹‰é¸å–®é«˜åº¦æ­£å¸¸ */
        .hidden-input { display: none; margin-top: 10px; } 
        button { background-color: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 20px; font-size: 16px; width: 100%; }
        button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“¸ å·¥ç¨‹ç…§ç‰‡æµ®æ°´å°è¨­å®š</h2>
    
    <form action="/process_watermark" method="post" enctype="multipart/form-data">
        
        <label for="photo">1. æ·»åŠ ç…§ç‰‡</label>
        <input type="file" id="photo" name="photo" accept="image/*" required capture="camera">
        
        <hr>

        <h3>æµ®æ°´å°å…§å®¹è¼¸å…¥</h3>

        <label for="project_select">2. å·¥ç¨‹åç¨±</label>
        <select id="project_select" name="project_select" required onchange="toggleCustomInput('project_select', 'custom_project_div')">
            <option value="" disabled selected>è«‹é¸æ“‡ä¸€å€‹å·¥ç¨‹</option>
            <option value="è¥¿æ¸¯åœ‹ä¸­113å¹´åº¦å»šæˆ¿æ“´å»ºå·¥ç¨‹">è¥¿æ¸¯åœ‹ä¸­113å¹´åº¦å»šæˆ¿æ“´å»ºå·¥ç¨‹</option>
            <option value="ç¶œåˆè¡Œæ”¿å¤§æ¨“(å«äºæ´²èˆªç©ºæ•…äº‹é¤¨ç©ºé–“)æ–°å»ºå·¥ç¨‹">ç¶œåˆè¡Œæ”¿å¤§æ¨“(å«äºæ´²èˆªç©ºæ•…äº‹é¤¨ç©ºé–“)æ–°å»ºå·¥ç¨‹</option>
            <option value="custom_new">è‡ªè¡Œè¼¸å…¥ (å¯ç·¨è¼¯)</option>
        </select>
        
        <div id="custom_project_div" class="hidden-input">
            <input type="text" id="custom_project_name" name="custom_project_name" placeholder="è«‹åœ¨æ­¤è¼¸å…¥å·¥ç¨‹åç¨±">
        </div>
        
        <label for="date_time">3. æ‹æ”æ™‚é–“ (å¹´/æœˆ/æ—¥)</label>
        <input type="date" id="date_time" name="date_time" required>

        <label for="floor_select">3. æ¨“å±¤</label>
        <select id="floor_select" name="floor_select" required>
            <option value="" disabled selected>è«‹é¸æ“‡ä¸€å€‹æ¨“å±¤</option>
            <option value="B1F">B1F</option>
            <option value="1F">1F</option>
            <option value="2F">2F</option>
            <option value="3F">3F</option>
            <option value="4F">4F</option>
            <option value="5F">5F</option>
        </select>
        <label for="task_items">4. å·¥é …å…§å®¹ (å–®é¸)</label>
        <select id="task_items" name="task_items" required>
            <option value="" disabled selected>è«‹é¸æ“‡å·¥é …</option>
            <option value="æ¨‘">æ¨‘</option>
            <option value="æŸ±">æŸ±</option>
            <option value="å¤©èŠ±æ¿">å¤©èŠ±æ¿</option>
            <option value="ç‰†">ç‰†</option>
            <option value="åœ°æ¿">åœ°æ¿</option>
            <option value="æ¨“æ¢¯">æ¨“æ¢¯</option>
            <option value="æ°´é›»">æ°´é›»</option>
        </select>
        
        <button type="submit">ç”Ÿæˆå¸¶æœ‰æµ®æ°´å°çš„ç…§ç‰‡</button>
    </form>
</div>

<script>
    // === JavaScript å¯¦ç¾åŠŸèƒ½ ===

    // 1. è¨­å®šæ™‚é–“é è¨­ç‚ºç•¶å‰æ™‚é–“ (è£œå…¨åŸæœ¬æˆªæ–·çš„ç¨‹å¼ç¢¼)
    function setDateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const today = `${year}-${month}-${day}`;
        document.getElementById('date_time').value = today;
    }

    // 2. åˆ‡æ›è‡ªè¨‚è¼¸å…¥æ¡†çš„é¡¯ç¤º/éš±è—
    function toggleCustomInput(selectId, divId) {
        const selectElement = document.getElementById(selectId);
        const divElement = document.getElementById(divId);
        
        if (!divElement) return; // é˜²æ­¢æ‰¾ä¸åˆ°å…ƒç´ å ±éŒ¯

        if (selectElement.value === "custom_new") {
            divElement.style.display = "block";
            const input = divElement.querySelector('input');
            if (input) input.setAttribute('required', 'required');
        } else {
            divElement.style.display = "none";
            const input = divElement.querySelector('input');
            if (input) input.removeAttribute('required');
        }
    }

    // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
    window.onload = function() {
        setDateTime();
    };
</script>

</body>
</html>